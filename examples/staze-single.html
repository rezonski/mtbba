<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8' />
    <title>Demo</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.39.1/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.39.1/mapbox-gl.css' rel='stylesheet' />
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <link href='css/style.css' rel='stylesheet' />
    <script src='js/jquery.min.js'></script>
    <script src='js/togeojson.js'></script>
    <script src='js/turf.min.js'></script>
    <script src='js/helper.js'></script>
</head>
<body>
<div class="visualisation">
    <div id='map' class='map'></div>
    <div class='details'>
        <div class='info'>
            <div class='info-distance'>
                <div class='label'>Duzina</div>
                <div class='value'>36 km</div>
            </div>
            <div class='info-elevation'>
                <div class='inline uphill'>
                    <div class='label'>Uspon</div>
                    <div class='value'>1350 m</div>
                </div>
                <div class='inline downhill'>
                    <div class='label'>Spust</div>
                    <div class='value'>1500 m</div>
                </div>
            </div>
            <div id='surface-pie' class='chart-pie'></div>
        </div>
        <div id='elevation-profile' class='chart-elevation'></div>
    </div>
</div>
<script>
    // GLOBALS
    window.importovano = {
        'trailName': 'Bradina - Martinov grob',
        'sastav': '28-35-11-1-0'
    };
    // MAP
    mapboxgl.accessToken = 'pk.eyJ1IjoibWVyc2FkcGFzaWMiLCJhIjoiY2lqenc1ZnpkMDA2N3ZrbHo4MzQ2Z2YzZyJ9.TIDhGaRGIYtw9_f_Yb3Ptg';
    $.ajax('upload/Bradina-Neretvica_profil.gpx').done(function(gpx) {
        var dataJSON = parseRaw(toGeoJSON.gpx(gpx));
        window.dataJSON = dataJSON;
        // console.log(dataJSON);
        // get center and bounds from json
        var box = turf.bbox(dataJSON);
        var bbox = [[box[0], box[1]], [box[2], box[3]]];
        var mapCenter = turf.center(dataJSON);
        var map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/light-v9',
            zoom: 5,
            center: mapCenter.geometry.coordinates
        });
        window.map = map;
        var popup = new mapboxgl.Popup({
            // closeButton: false,
            closeOnClick: false
        });
        map.on('load', function() {
            map.fitBounds(bbox);
            addTrailLayers(map);
            addPopups(map, popup);
            addChart(map, dataJSON);
        });
    });
</script>
</body>
</html>
